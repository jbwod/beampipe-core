
![beampipe-core pipeline trace diagram](/trace.svg)

![text](https://github.com/user-attachments/assets/2f989202-a13f-4928-b897-5aa595a5fb54)<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 11.380000114440918 443.1499938964844 48.56999969482422" data-asc="0.99" width="443.1499938964844" height="48.56999969482422"><defs/><g fill="#ffffff"><g transform="translate(0, 0)"><path d="M7.80 29.90Q9.70 29.90 11 30.65Q12.30 31.40 13.30 32.40Q14.30 33.40 15.24 34.15Q16.18 34.90 17.33 34.90Q18.93 34.90 20.20 33.61Q21.48 32.33 22.43 30.57L25 31.97Q24.38 33.13 23.39 34.50Q22.40 35.88 20.90 36.86Q19.40 37.85 17.20 37.85Q15.45 37.85 14.19 37.10Q12.93 36.35 11.90 35.35Q10.88 34.35 9.88 33.60Q8.88 32.85 7.68 32.85Q6 32.85 4.78 34.11Q3.55 35.38 2.58 37.17L0 35.83Q0.68 34.55 1.64 33.17Q2.60 31.80 4.10 30.85Q5.60 29.90 7.80 29.90ZM66.08 26.88Q67.58 24.90 69.51 23.84Q71.45 22.77 73.80 22.77Q77.35 22.77 79.53 24.47Q81.70 26.17 82.69 29.24Q83.67 32.30 83.67 36.38Q83.67 40.33 82.49 43.40Q81.30 46.48 79 48.24Q76.70 50 73.33 50Q68.63 50 65.97 46.67L65.67 49.50L62.98 49.50L62.98 12.63L66.08 12.20L66.08 26.88M72.65 47.30Q76.30 47.30 78.24 44.56Q80.17 41.83 80.17 36.33Q80.17 32.83 79.41 30.40Q78.65 27.97 77.14 26.70Q75.63 25.42 73.35 25.42Q70.90 25.42 69.05 26.89Q67.20 28.35 66.08 30L66.08 43.60Q67.20 45.27 68.94 46.29Q70.67 47.30 72.65 47.30ZM95.22 37.63Q95.30 40.92 96.41 43.04Q97.53 45.15 99.35 46.15Q101.17 47.15 103.33 47.15Q105.40 47.15 107.01 46.55Q108.63 45.95 110.40 44.73L112.03 47.05Q110.20 48.45 107.91 49.23Q105.63 50 103.45 50Q99.83 50 97.24 48.30Q94.65 46.60 93.28 43.54Q91.90 40.48 91.90 36.40Q91.90 32.40 93.30 29.32Q94.70 26.25 97.19 24.51Q99.67 22.77 102.97 22.77Q106.17 22.77 108.45 24.32Q110.72 25.88 111.94 28.71Q113.15 31.55 113.15 35.48Q113.15 36.15 113.13 36.69Q113.10 37.23 113.08 37.63L95.22 37.63M103.05 25.67Q99.88 25.67 97.71 27.92Q95.55 30.17 95.28 34.83L110.20 34.83Q110.10 30.20 108.13 27.94Q106.15 25.67 103.05 25.67ZM140.80 44.33Q140.80 45.92 141.35 46.66Q141.90 47.40 143.05 47.75L142.20 50.02Q140.70 49.80 139.53 48.92Q138.35 48.05 137.88 46.25Q136.50 48.08 134.44 49.04Q132.38 50 129.78 50Q125.88 50 123.65 47.80Q121.42 45.60 121.42 41.92Q121.42 37.92 124.54 35.80Q127.65 33.67 133.60 33.67L137.57 33.67L137.57 31.13Q137.57 28.05 135.81 26.81Q134.05 25.57 131 25.57Q129.68 25.57 128 25.88Q126.33 26.17 124.28 26.90L123.38 24.35Q125.75 23.47 127.69 23.13Q129.63 22.77 131.45 22.77Q136.07 22.77 138.44 25.04Q140.80 27.30 140.80 31.02L140.80 44.33M130.38 47.52Q132.53 47.52 134.40 46.48Q136.28 45.42 137.57 43.55L137.57 36.05L133.22 36.05Q128.55 36.05 126.70 37.69Q124.85 39.33 124.85 42.02Q124.85 44.75 126.20 46.14Q127.55 47.52 130.38 47.52ZM169.65 22.77Q170.72 22.77 171.88 23.26Q173.03 23.75 173.82 25.27Q174.63 26.80 174.63 29.92L174.63 49.50L171.57 49.50L171.57 30.52Q171.57 27.72 171.26 26.47Q170.95 25.22 169.35 25.22Q168 25.22 166.69 26.06Q165.38 26.90 164.20 28.80L164.20 49.50L160.75 49.50L160.75 30.52Q160.75 27.72 160.44 26.47Q160.13 25.22 158.53 25.22Q157.13 25.22 155.84 26.06Q154.55 26.90 153.38 28.80L153.38 49.50L150.38 49.50L150.38 23.25L152.93 23.25L153.10 26.42Q154.13 24.95 155.49 23.86Q156.85 22.77 158.88 22.77Q160.38 22.77 161.79 23.49Q163.20 24.20 163.88 26.35Q164.90 24.75 166.22 23.76Q167.55 22.77 169.65 22.77ZM193.88 22.77Q197.40 22.77 199.47 24.47Q201.55 26.17 202.45 29.24Q203.35 32.30 203.35 36.38Q203.35 40.33 202.26 43.40Q201.18 46.48 198.94 48.24Q196.70 50 193.22 50Q188.75 50 186.07 46.88L186.07 59.52L182.97 59.95L182.97 23.25L185.53 23.25L185.88 27.13Q187.28 25.13 189.31 23.95Q191.35 22.77 193.88 22.77M193.32 25.42Q190.90 25.42 189.05 26.89Q187.20 28.35 186.07 30L186.07 43.60Q187.18 45.23 188.93 46.20Q190.68 47.17 192.72 47.17Q196.38 47.17 198.16 44.50Q199.95 41.83 199.95 36.33Q199.95 32.83 199.25 30.40Q198.55 27.97 197.09 26.70Q195.63 25.42 193.32 25.42ZM225.45 23.25L225.45 46.80L233.07 46.80L233.07 49.50L214.05 49.50L214.05 46.80L222.35 46.80L222.35 25.95L214.30 25.95L214.30 23.25L225.45 23.25M222.53 11.38Q223.72 11.38 224.43 12.10Q225.13 12.82 225.13 13.85Q225.13 14.95 224.43 15.69Q223.72 16.42 222.53 16.42Q221.40 16.42 220.70 15.69Q220 14.95 220 13.85Q220 12.82 220.70 12.10Q221.40 11.38 222.53 11.38ZM253.88 22.77Q257.40 22.77 259.48 24.47Q261.55 26.17 262.45 29.24Q263.35 32.30 263.35 36.38Q263.35 40.33 262.26 43.40Q261.18 46.48 258.94 48.24Q256.70 50 253.22 50Q248.75 50 246.07 46.88L246.07 59.52L242.97 59.95L242.97 23.25L245.53 23.25L245.88 27.13Q247.28 25.13 249.31 23.95Q251.35 22.77 253.88 22.77M253.32 25.42Q250.90 25.42 249.05 26.89Q247.20 28.35 246.07 30L246.07 43.60Q247.18 45.23 248.93 46.20Q250.68 47.17 252.72 47.17Q256.38 47.17 258.16 44.50Q259.95 41.83 259.95 36.33Q259.95 32.83 259.25 30.40Q258.55 27.97 257.09 26.70Q255.63 25.42 253.32 25.42ZM275.23 37.63Q275.30 40.92 276.41 43.04Q277.52 45.15 279.35 46.15Q281.18 47.15 283.32 47.15Q285.40 47.15 287.01 46.55Q288.63 45.95 290.40 44.73L292.02 47.05Q290.20 48.45 287.91 49.23Q285.63 50 283.45 50Q279.82 50 277.24 48.30Q274.65 46.60 273.27 43.54Q271.90 40.48 271.90 36.40Q271.90 32.40 273.30 29.32Q274.70 26.25 277.19 24.51Q279.68 22.77 282.98 22.77Q286.18 22.77 288.45 24.32Q290.73 25.88 291.94 28.71Q293.15 31.55 293.15 35.48Q293.15 36.15 293.13 36.69Q293.10 37.23 293.07 37.63L275.23 37.63M283.05 25.67Q279.88 25.67 277.71 27.92Q275.55 30.17 275.27 34.83L290.20 34.83Q290.10 30.20 288.13 27.94Q286.15 25.67 283.05 25.67ZM302.73 35.30L302.73 32.40L322.27 32.40L322.27 35.30L302.73 35.30ZM344.23 47.15Q346.32 47.15 348.11 46.50Q349.90 45.85 351.35 44.83L352.98 46.92Q351.25 48.38 348.85 49.19Q346.45 50 344.35 50Q340.52 50 337.86 48.34Q335.20 46.67 333.81 43.63Q332.43 40.58 332.43 36.48Q332.43 32.58 333.81 29.47Q335.20 26.38 337.86 24.57Q340.52 22.77 344.38 22.77Q346.75 22.77 348.91 23.52Q351.07 24.27 352.90 25.75L351.25 27.97Q349.48 26.75 347.74 26.14Q346 25.52 344.23 25.52Q340.60 25.52 338.24 28.27Q335.88 31.02 335.88 36.48Q335.88 40.15 336.95 42.51Q338.02 44.88 339.91 46.01Q341.80 47.15 344.23 47.15ZM372.57 22.77Q376.18 22.77 378.57 24.45Q380.98 26.13 382.16 29.17Q383.35 32.22 383.35 36.38Q383.35 40.27 382.13 43.35Q380.90 46.42 378.49 48.21Q376.07 50 372.50 50Q368.90 50 366.49 48.29Q364.07 46.58 362.86 43.51Q361.65 40.45 361.65 36.42Q361.65 32.40 362.88 29.32Q364.10 26.25 366.54 24.51Q368.98 22.77 372.57 22.77M372.57 25.50Q368.88 25.50 366.96 28.17Q365.05 30.85 365.05 36.42Q365.05 41.88 366.93 44.56Q368.80 47.25 372.50 47.25Q376.20 47.25 378.07 44.56Q379.95 41.88 379.95 36.38Q379.95 30.85 378.09 28.17Q376.23 25.50 372.57 25.50ZM393.23 49.50L393.23 46.90L397.50 46.90L397.50 25.88L393.23 25.88L393.23 23.25L399.88 23.25L400.45 29.55Q402 26.35 404.16 24.54Q406.32 22.72 410 22.72Q411.02 22.72 411.84 22.88Q412.65 23.02 413.55 23.25L412.68 26.17Q411.80 25.92 411.14 25.81Q410.48 25.70 409.63 25.70Q406.45 25.70 404.23 27.86Q402 30.02 400.60 34.70L400.60 46.90L406 46.90L406 49.50L393.23 49.50M410.20 31.50L410.20 26.38L410.40 23.25L413.55 23.25L413.20 31.50L410.20 31.50ZM425.23 37.63Q425.30 40.92 426.41 43.04Q427.52 45.15 429.35 46.15Q431.18 47.15 433.32 47.15Q435.40 47.15 437.01 46.55Q438.63 45.95 440.40 44.73L442.02 47.05Q440.20 48.45 437.91 49.23Q435.63 50 433.45 50Q429.82 50 427.24 48.30Q424.65 46.60 423.27 43.54Q421.90 40.48 421.90 36.40Q421.90 32.40 423.30 29.32Q424.70 26.25 427.19 24.51Q429.68 22.77 432.98 22.77Q436.18 22.77 438.45 24.32Q440.73 25.88 441.94 28.71Q443.15 31.55 443.15 35.48Q443.15 36.15 443.13 36.69Q443.10 37.23 443.07 37.63L425.23 37.63M433.05 25.67Q429.88 25.67 427.71 27.92Q425.55 30.17 425.27 34.83L440.20 34.83Q440.10 30.20 438.13 27.94Q436.15 25.67 433.05 25.67Z"/></g></g></svg>

> `beampipe-core` is a modular orchestration and triggering framework for data-driven radio astronomy workflows. It operates as an external control plane that continuously monitors scientific archives (ie; CASDA), determines when datasets are ready, and orchestrates scheduler-aware execution of distributed workflows (ie; DALiuGe) on heterogeneous HPC systems.


## `What it does`

> - **`Archive-driven triggering`**: discovers newly deposited datasets via polling or event-style ingestion and triggers processing automatically.

> - **`Idempotent run ledger`**: records each trigger to guarantee completeness, avoid duplicate processing, and enable safe retries.

> - **`Scheduler-aware orchestration`**: submits workloads to batch schedulers with queue/cluster constraints in mind.

> - **`Workflow-agnostic execution`**: treats pipelines as portable work items to support [DALiuGE](https://daliuge.icrar.org/) or future WMS.

> - **`Deterministic provenance`**: captures inputs, parameters, container digests, checksum outputs, and signatures for reproducibility.

## `Core Module Features`
> - **`Source registry`**: register and manage astronomical sources via common-ID (API + basic web UI at `/sources`) and supports bulk registration.

> - **`Run ledger enforcement`**: validates runs against registered/enabled sources to prevent invalid triggers.

> - **`Trigger and Schedule Setup`**: monitors and polls configured storage archives for new-to-process observation datasets. Configurable parameters give control to frequency, batch-size and lifetime.

> - **`Direct-to-Compute`**: integrates with existing workflow management and HPC Tooling.

## `Modular by design`
> Designed from the ground-up to be Survey-Agnostic, a pluggable module based system to allow not only allows new data-stores to be configured, but new workflows, schedulers or compute environments. The example module was constructed for the [`wallaby-hires`](https://github.com/ICRAR/wallaby-hires) project and workflow, integrating ingestion with CASDA and HPC Compute on [pawsey-setonix](https://pawsey.org.au/systems/setonix/).



### The "backend"
> Based on the excellent, [FastAPI boilerplate](https://github.com/benavlabs/FastAPI-boilerplate)
*  Fully async FastAPI + SQLAlchemy 2.0
* ğŸ§± Pydantic v2 models & validation
* ğŸ” JWT auth (access + refresh), cookies for refresh
* ğŸ§° FastCRUD for efficient CRUD & pagination
* ğŸš¦ ARQ background jobs (Redis)
* ğŸ§Š Redis caching (server + client-side headers)
* ğŸŒ Configurable CORS middleware for frontend integration
* ğŸ³ One-command Docker Compose
* ğŸš€ NGINX & Gunicorn recipes for prod


## Start the 

1. Create environment variables: copy an env example from `scripts/*/.env.example` to `src/.env` and adjust secrets.
2. With Docker Compose:
   ```bash
   ./setup.py local  # or staging / production
   docker compose up
   ```
3. API docs are available at `/docs` when `ENVIRONMENT=local`.



## Contributing

Read [CONTRIBUTING.md](CONTRIBUTING.md).
